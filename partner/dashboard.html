<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEOTIZE Partner Dashboard</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>

<style>
/* CSS Variables */
:root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;
    --secondary: #10b981;
    --secondary-dark: #059669;
    --accent: #f59e0b;
    --error: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --info: #3b82f6;

    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    
    --radius-sm: 8px;
    --radius: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);

    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Light Theme */
[data-theme="light"] {
    --bg: #f8f9fa;
    --bg-secondary: #ffffff;
    --bg-tertiary: #e9ecef;
    --sidebar: #ffffff;
    --card: #ffffff;
    --card-hover: #f8f9fa;
    --text: #212529;
    --text-secondary: #6c757d;
    --text-tertiary: #adb5bd;
    --border: #dee2e6;
    --input-bg: #ffffff;
}

/* Dark Theme */
[data-theme="dark"] {
    --bg: #0a0a0a;
    --bg-secondary: #1a1a1a;
    --bg-tertiary: #2a2a2a;
    --sidebar: #141414;
    --card: #1f1f1f;
    --card-hover: #2a2a2a;
    --text: #ffffff;
    --text-secondary: #a0a0a0;
    --text-tertiary: #6b6b6b;
    --border: rgba(255, 255, 255, 0.1);
    --input-bg: #1a1a1a;
}

/* Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    transition: var(--transition);
    line-height: 1.6;
    overflow-x: hidden;
}

/* Layout */
.dashboard-layout {
    display: flex;
    min-height: 100vh;
}

/* Sidebar */
.sidebar {
    width: 280px;
    background: var(--sidebar);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    transition: var(--transition);
}

.sidebar-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
    text-decoration: none;
}

.sidebar-nav {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
}

.nav-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
    padding: 0 0.75rem;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: var(--radius);
    color: var(--text-secondary);
    text-decoration: none;
    transition: var(--transition);
    cursor: pointer;
    margin-bottom: 0.25rem;
}

.nav-item:hover {
    background: var(--bg-tertiary);
    color: var(--text);
}

.nav-item.active {
    background: var(--primary);
    color: white;
}

.nav-item i {
    font-size: 1.25rem;
    width: 1.5rem;
    text-align: center;
}

/* Main Content */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Header */
.header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border);
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left h2 {
    font-size: 1.5rem;
    font-weight: 700;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.theme-toggle {
    padding: 0.5rem;
    border-radius: var(--radius);
    background: transparent;
    border: none;
    color: var(--text);
    cursor: pointer;
    font-size: 1.25rem;
    transition: var(--transition);
}

.theme-toggle:hover {
    background: var(--bg-tertiary);
}

/* Mobile Profile Menu - Google Style */
.mobile-profile-menu {
    display: none;
    padding: 0;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: var(--text);
    cursor: pointer;
    font-size: 1.25rem;
    transition: var(--transition);
    position: relative;
}

.mobile-profile-menu:hover .user-avatar {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.mobile-profile-menu .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.875rem;
    transition: box-shadow 0.2s ease;
}

/* Google-style Profile Dropdown */
.mobile-profile-dropdown {
    display: none;
    position: fixed;
    top: 60px;
    right: 1rem;
    background: var(--card);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    z-index: 10001;
    overflow: hidden;
    animation: slideDown 0.2s ease;
    min-width: 280px;
}

.mobile-profile-dropdown.active {
    display: block;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.user-menu-container {
    position: relative;
}

.user-menu {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    background: var(--bg-tertiary);
    cursor: pointer;
    transition: var(--transition);
}

.user-menu:hover {
    background: var(--card-hover);
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
}

.user-dropdown {
    position: absolute;
    top: calc(100% + 0.5rem);
    right: 0;
    min-width: 220px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow-xl);
    display: none;
    z-index: 1000;
}

.user-dropdown.active {
    display: block;
}

.user-dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: var(--text);
    text-decoration: none;
    transition: var(--transition);
    cursor: pointer;
}

.user-dropdown-item:hover {
    background: var(--bg-tertiary);
}

.user-dropdown-item i {
    width: 1.25rem;
}

.user-dropdown-item.danger {
    color: var(--error);
}

/* Content Area */
.content {
    flex: 1;
    padding: 1.5rem;
    overflow-y: auto;
}

/* Cards */
.card {
    background: var(--card);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    transition: var(--transition);
    margin-bottom: 1.5rem;
}

.card-header {
    padding: 1.25rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text);
}

.card-body {
    padding: 1.25rem;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 1.25rem;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-primary);
}

.stat-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.stat-icon.primary { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
.stat-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
.stat-icon.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }

.stat-content {
    flex: 1;
    min-width: 0;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

/* Buttons */
.btn {
    padding: 0.625rem 1.25rem;
    border-radius: var(--radius);
    font-weight: 500;
    font-size: 0.875rem;
    border: none;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }
.btn-secondary { background: var(--bg-tertiary); color: var(--text); }
.btn-secondary:hover { background: var(--border); }
.btn-danger { background: var(--error); color: white; }
.btn-danger:hover { background: #dc2626; }
.btn-sm { padding: 0.375rem 0.75rem; font-size: 0.8125rem; }
.btn:disabled { opacity: 0.6; cursor: not-allowed; }

/* Forms */
.form-group { margin-bottom: 1.5rem; }
.form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text); }
.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 0.625rem 1rem;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--input-bg);
    color: var(--text);
    font-size: 0.875rem;
    transition: var(--transition);
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* Tables */
.table-container { 
    overflow-x: auto; 
    border-radius: var(--radius);
    border: 1px solid var(--border);
}
table { width: 100%; border-collapse: collapse; }
th { 
    background: var(--bg-tertiary); 
    padding: 0.75rem 1rem; 
    text-align: left; 
    font-weight: 600;
    color: var(--text);
    border-bottom: 1px solid var(--border); 
}
td { 
    padding: 0.75rem 1rem; 
    border-bottom: 1px solid var(--border); 
    color: var(--text-secondary); 
}
tr:last-child td { border-bottom: none; }
tr:hover { background: var(--card-hover); }

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 2rem;
    padding: 1rem;
    background: var(--card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    flex-wrap: wrap;
}

.pagination-btn {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--bg-secondary);
    color: var(--text);
    cursor: pointer;
    transition: var(--transition);
    font-size: 0.875rem;
}

.pagination-btn:hover:not(:disabled) {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.pagination-info {
    margin: 0 1rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

/* Modal */
.modal-overlay { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    right: 0; 
    bottom: 0; 
    background: rgba(0, 0, 0, 0.5); 
    backdrop-filter: blur(4px); 
    z-index: 1000; 
    animation: fadeIn 0.3s; 
}
.modal-overlay.active { 
    display: flex; 
    align-items: center; 
    justify-content: center; 
}
.modal { 
    background: var(--card); 
    border-radius: var(--radius-xl); 
    max-width: 90vw; 
    width: 600px; 
    max-height: 90vh; 
    overflow: hidden; 
    animation: slideUp 0.3s; 
}
.modal-header { 
    padding: 1.5rem; 
    border-bottom: 1px solid var(--border); 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
}
.modal-title { 
    font-size: 1.25rem; 
    font-weight: 600; 
    color: var(--text);
}
.modal-close { 
    background: transparent; 
    border: none; 
    color: var(--text-secondary); 
    font-size: 1.5rem; 
    cursor: pointer;
    transition: var(--transition);
}
.modal-close:hover {
    color: var(--text);
}
.modal-body { 
    padding: 1.5rem; 
    max-height: calc(90vh - 140px); 
    overflow-y: auto; 
}

/* Toast */
.toast { 
    position: fixed; 
    bottom: 2rem; 
    right: 2rem; 
    padding: 1rem 1.5rem; 
    background: var(--card); 
    border-radius: var(--radius); 
    box-shadow: var(--shadow-xl); 
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: slideInRight 0.3s; 
    z-index: 2000; 
}
.toast.success { border-left: 4px solid var(--success); }
.toast.error { border-left: 4px solid var(--error); }
.toast.warning { border-left: 4px solid var(--warning); }
.toast.info { border-left: 4px solid var(--info); }

/* Task Cards */
.task-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
    gap: 1.5rem; 
}

.available-task-card { 
    background: var(--card); 
    border: 1px solid var(--border); 
    border-radius: var(--radius-lg); 
    padding: 1.25rem; 
    transition: var(--transition); 
}

.available-task-card.active-task {
    cursor: pointer;
}

.available-task-card.active-task:hover { 
    transform: translateY(-3px); 
    box-shadow: var(--shadow-lg); 
    border-color: var(--primary);
}

.task-card-header { 
    margin-bottom: 1rem; 
}

.task-url { 
    font-weight: 600; 
    word-break: break-all; 
    color: var(--text);
    font-size: 0.95rem;
    line-height: 1.4;
}

.task-priority-badge {
    display: inline-block;
    padding: 0.25rem 0.6rem;
    border-radius: 99px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-top: 0.5rem;
}

.task-priority-badge.high {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
}

.task-priority-badge.medium {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.task-priority-badge.low {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.task-keywords { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 0.5rem; 
    margin-top: 0.75rem; 
}

.keyword-badge { 
    background: var(--bg-tertiary); 
    color: var(--text-secondary); 
    padding: 0.25rem 0.6rem; 
    border-radius: 99px; 
    font-size: 0.75rem; 
}

.task-footer { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-top: 1.5rem; 
    padding-top: 1rem; 
    border-top: 1px solid var(--border); 
}

.task-credit { 
    font-size: 1.25rem; 
    font-weight: 700; 
    color: var(--primary); 
}

.available-task-card.inactive-task { 
    opacity: 0.6; 
    background: var(--bg-tertiary); 
    cursor: not-allowed;
}

.inactive-task .task-footer { 
    position: relative; 
}

.inactive-overlay { 
    position: absolute; 
    top: 0; 
    left: 0; 
    right: 0; 
    bottom: 0; 
    display: flex;
    flex-direction: column;
    align-items: center; 
    justify-content: center; 
    text-align: center;
    gap: 0.25rem;
}

/* Badge */
.badge { 
    display: inline-block; 
    padding: 0.25rem 0.5rem; 
    border-radius: var(--radius-sm); 
    font-size: 0.75rem; 
    font-weight: 600; 
}
.badge-primary { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
.badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
.badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
.badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--error); }

/* Spinner */
.spinner { 
    width: 40px; 
    height: 40px; 
    border: 3px solid var(--border); 
    border-top-color: var(--primary); 
    border-radius: 50%; 
    animation: spin 1s linear infinite; 
}

/* Empty State */
.empty-state { 
    text-align: center; 
    padding: 3rem; 
}
.empty-state-icon { 
    font-size: 4rem; 
    color: var(--text-tertiary); 
    margin-bottom: 1rem; 
}
.empty-state-title { 
    font-size: 1.5rem; 
    font-weight: 600; 
    margin-bottom: 0.5rem;
    color: var(--text);
}
.empty-state-description { 
    color: var(--text-secondary); 
    margin-bottom: 1.5rem; 
}

/* Mobile Bottom Navigation */
.mobile-nav { 
    display: none; 
    position: fixed; 
    bottom: 0; 
    left: 0; 
    right: 0; 
    background: var(--card); 
    border-top: 1px solid var(--border); 
    z-index: 50; 
    padding: 0.5rem;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}
.mobile-nav-items { 
    display: flex; 
    justify-content: space-around; 
}
.mobile-nav-item { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    gap: 0.25rem; 
    padding: 0.5rem; 
    color: var(--text-secondary); 
    text-decoration: none; 
    font-size: 0.75rem; 
    flex: 1;
    border-radius: var(--radius);
    transition: var(--transition);
}
.mobile-nav-item:active {
    transform: scale(0.95);
}
.mobile-nav-item.active { 
    color: var(--primary);
    background: rgba(99, 102, 241, 0.1);
}
.mobile-nav-item i { 
    font-size: 1.25rem; 
}

/* Responsive Design */
@media (max-width: 768px) {
    .sidebar { 
        display: none; 
    }
    
    .mobile-nav { 
        display: block; 
    }
    
    .main-content { 
        padding-bottom: 60px; 
    }
    
    .header { 
        padding: 0.75rem;
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .header-left h2 {
        font-size: 1.1rem;
    }
    
    .user-menu-container {
        display: none !important;
    }
    
    .mobile-profile-menu {
        display: flex;
    }
    
    .user-dropdown {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        min-width: 100%;
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        max-height: 50vh;
        overflow-y: auto;
    }
    
    .stats-grid { 
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }
    
    .stat-card {
        padding: 0.875rem;
    }
    
    .stat-icon {
        display: none;
    }
    
    .stat-value {
        font-size: 1.5rem;
    }
    
    .stat-label {
        font-size: 0.75rem;
    }
    
    .task-grid { 
        grid-template-columns: 1fr; 
    }
    
    .content { 
        padding: 1rem; 
    }
    
    .modal { 
        width: 100%;
        max-width: 100%;
        margin: 0;
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
    }
    
    .modal-body {
        max-height: calc(100vh - 60px);
    }
    
    .card-header {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .table-container {
        font-size: 0.8125rem;
    }
    
    th, td {
        padding: 0.5rem;
    }
    
    .pagination {
        padding: 0.75rem;
        gap: 0.35rem;
    }
    
    .pagination-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.8rem;
    }
    
    .pagination-info {
        font-size: 0.75rem;
        margin: 0.5rem 0;
        width: 100%;
        text-align: center;
    }
    
    .btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }
    
    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .header-left h2 {
        font-size: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
    }

    .stat-card {
        padding: 0.75rem;
    }

    .stat-value {
        font-size: 1.25rem;
    }

    .stat-label {
        font-size: 0.7rem;
    }

    .mobile-nav-item span {
        font-size: 0.625rem;
    }

    .mobile-nav-item i {
        font-size: 1.125rem;
    }
    
    .task-credit {
        font-size: 1.1rem;
    }
}

/* Animations */
@keyframes fadeIn { 
    from { opacity: 0; } 
    to { opacity: 1; } 
}

@keyframes slideUp { 
    from { 
        transform: translateY(20px); 
        opacity: 0; 
    } 
    to { 
        transform: translateY(0); 
        opacity: 1; 
    } 
}

@keyframes slideInRight { 
    from { 
        transform: translateX(100%); 
        opacity: 0;
    } 
    to { 
        transform: translateX(0);
        opacity: 1;
    } 
}

@keyframes spin { 
    to { transform: rotate(360deg); } 
}

/* Desktop/Mobile visibility classes */
.desktop-only {
    display: block !important;
}

.mobile-only {
    display: none !important;
}

@media (max-width: 768px) {
    .desktop-only {
        display: none !important;
    }

    .mobile-only {
        display: block !important;
    }
}
</style>
</head>
<body data-theme="light">
<div class="dashboard-layout">
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <a href="#" class="logo">
            <i class="ri-user-star-line"></i>
            <span>SEOTIZE Partner</span>
        </a>
    </div>
    <nav class="sidebar-nav">
        <div class="nav-section">
            <div class="nav-section-title">Main</div>
            <a href="#" class="nav-item active" data-page="dashboard">
                <i class="ri-dashboard-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-page="balance">
                <i class="ri-wallet-3-line"></i>
                <span>Balance & Withdraw</span>
            </a>
        </div>
    </nav>
</aside>

<nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-items">
        <a href="#" class="mobile-nav-item active" data-page="dashboard">
            <i class="ri-dashboard-line"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="mobile-nav-item" data-page="balance">
            <i class="ri-wallet-3-line"></i>
            <span>Balance</span>
        </a>
    </div>
</nav>

<main class="main-content">
    <header class="header">
        <div class="header-left">
            <h2>Partner Dashboard</h2>
        </div>
        <div class="header-right">
            <button class="theme-toggle" onclick="toggleTheme()">
                <i class="ri-moon-line" id="themeIcon"></i>
            </button>

            <!-- Mobile Profile Menu Icon -->
            <button class="mobile-profile-menu" onclick="toggleMobileProfileDropdown(event)">
                <div class="user-avatar" id="mobileUserAvatar">P</div>
            </button>

            <!-- Mobile Profile Dropdown -->
            <div id="mobileProfileDropdown" class="mobile-profile-dropdown">
                <div style="padding: 1rem; background: var(--bg-tertiary); border-bottom: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="user-avatar" style="width: 48px; height: 48px; font-size: 1.25rem;">
                            <span id="mobileDropdownUserInitial">P</span>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text);" id="mobileDropdownUserName">Partner</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);" id="mobileDropdownUserEmail">partner@example.com</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.5rem 0;">
                    <a href="#" class="nav-item" onclick="logout(); closeMobileProfileDropdown()" style="padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--error);">
                        <i class="ri-logout-box-line"></i>
                        <span>Sign Out</span>
                    </a>
                </div>
            </div>

            <div class="user-menu-container">
                <div class="user-menu" onclick="toggleUserDropdown()">
                    <div class="user-avatar"><span id="userInitial">P</span></div>
                    <div>
                        <div style="font-weight: 500;" id="userName">Partner</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);" id="userEmail">partner@example.com</div>
                    </div>
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" class="user-dropdown-item danger" onclick="logout()">
                        <i class="ri-logout-box-line"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="content" id="content">
        <!-- Content will be dynamically loaded here -->
    </div>
</main>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Modal Title</h3>
            <button class="modal-close" onclick="closeModal()">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<script>
function getBrowserData() {
    var userAgent = navigator.userAgent;
    var language = navigator.language;
    var platform = navigator.platform;
    var screenResolution = screen.width + 'x' + screen.height;
    var combinedData = `${userAgent}|${language}|${platform}|${screenResolution}`;
    return combinedData;
}

function hashData(data) {
    return CryptoJS.MD5(data).toString();
}

function getUniqueId() {
    var browserData = getBrowserData();
    return hashData(browserData);
}
    
// API Configuration
const API_BASE = 'https://api.seotize.net';
let sessionToken = getCookie('session_token_partner') || localStorage.getItem('partnerAuthToken');

// Global State
let currentData = {
    user: null,
    tasks: [],
    balance: null
};

let paginationState = {
    tasks: { current: 1, page: 1, size: 12, total: 0, pages: 1, hasNext: false },
    done_tasks: { current: 1, page: 1, size: 7, total: 0, pages: 1, hasNext: false },
    withdrawals: { current: 1, page: 1, size: 10, total: 0, pages: 1, hasNext: false }
};

let countdownIntervals = {};
let paginationHandlers = {};

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    if (!sessionToken) {
        logout();
        return;
    }

    initializeEventListeners();
    loadPartnerDashboard();
    initializeTheme();
});

// Event Listeners
function initializeEventListeners() {
    document.querySelectorAll('.sidebar .nav-item[data-page]').forEach(item => {
        item.addEventListener('click', (e) => { 
            e.preventDefault(); 
            navigateTo(item.dataset.page); 
        });
    });
    
    document.querySelectorAll('.mobile-nav-item[data-page]').forEach(item => {
        item.addEventListener('click', (e) => { 
            e.preventDefault(); 
            navigateTo(item.dataset.page); 
        });
    });
    
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) closeModal();
    });
    
    document.addEventListener('click', (e) => {
        const container = document.querySelector('.user-menu-container');
        if (container && !container.contains(e.target)) {
            document.getElementById('userDropdown').classList.remove('active');
        }
        
        const mobileDropdown = document.getElementById('mobileProfileDropdown');
        const mobileButton = document.querySelector('.mobile-profile-menu');
        if (mobileDropdown && mobileButton && 
            !mobileDropdown.contains(e.target) && 
            !mobileButton.contains(e.target)) {
            closeMobileProfileDropdown();
        }
    });
}

function toggleUserDropdown() {
    document.getElementById('userDropdown').classList.toggle('active');
}

function toggleMobileProfileDropdown(event) {
    event.stopPropagation();
    const dropdown = document.getElementById('mobileProfileDropdown');
    if (dropdown) {
        dropdown.classList.toggle('active');
        if (dropdown.classList.contains('active')) {
            const user = currentData.user;
            if (user) {
                const initial = (user.email || 'P').charAt(0).toUpperCase();
                document.getElementById('mobileDropdownUserInitial').textContent = initial;
                const nameEl = document.getElementById('mobileDropdownUserName');
                if (nameEl) nameEl.textContent = user.email.split('@')[0];
                document.getElementById('mobileDropdownUserEmail').textContent = user.email || '';
            }
        }
    }
}

function closeMobileProfileDropdown() {
    const dropdown = document.getElementById('mobileProfileDropdown');
    if (dropdown) {
        dropdown.classList.remove('active');
    }
}

function initializeTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);
}

function toggleTheme() {
    const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeIcon(newTheme);
}

function updateThemeIcon(theme) {
    document.getElementById('themeIcon').className = theme === 'light' ? 'ri-moon-line' : 'ri-sun-line';
}

function navigateTo(page) {
    document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => item.classList.remove('active'));
    document.querySelector(`.nav-item[data-page="${page}"]`)?.classList.add('active');
    document.querySelector(`.mobile-nav-item[data-page="${page}"]`)?.classList.add('active');

    switch(page) {
        case 'dashboard': loadPartnerDashboard(); break;
        case 'balance': loadBalanceManagement(); break;
    }
}

function updateUserInfo(user) {
    if (!user) return;
    const email = user.email;
    const initial = email[0].toUpperCase();
    const name = email.split('@')[0];
    
    document.getElementById('userInitial').textContent = initial;
    document.getElementById('userName').textContent = name;
    document.getElementById('userEmail').textContent = email;
    
    const mobileAvatar = document.getElementById('mobileUserAvatar');
    if (mobileAvatar) mobileAvatar.textContent = initial;
}

async function api(endpoint, options = {}) {
    const response = await fetch(`${API_BASE}${endpoint}`, {
        ...options,
        headers: { 
            'Session-Token': sessionToken, 
            'Content-Type': 'application/json', 
            ...(options.headers || {}) 
        }
    });
    const data = await response.json();
    if (!response.ok) throw new Error(data.error?.message || data.message || 'API Error');
    return data;
}

function callPaginationHandler(handlerId, page) {
    if (paginationHandlers[handlerId]) {
        paginationHandlers[handlerId](page);
    }
}

async function loadPartnerDashboard(page = 1) {
    try {
        showSpinner();
        const response = await api(`/partner/dashboard?page=${page}&page_size=12`);
        
        const { data, pagination } = response;
        currentData.user = data.user;
        updateUserInfo(data.user);
        
        if (data.incomplete_task) {
            renderIncompleteTaskView(data.tasks);
        } else {
            // Process and sort tasks
            currentData.tasks = sortTasks(data.tasks || []);
            
            // Fix pagination state
            paginationState.tasks = {
                current: pagination.tasks?.current || page,
                page: pagination.tasks?.current || page,
                size: pagination.tasks?.size || 12,
                total: pagination.tasks?.total || 0,
                pages: pagination.tasks?.pages || 1,
                hasNext: pagination.tasks?.has_next || false
            };
            
            renderAvailableTasksView();
        }
    } catch (error) {
        console.error('Dashboard error:', error);
        showErrorState('Failed to load dashboard data: ' + error.message);
    }
}

function sortTasks(tasks) {
    return tasks.sort((a, b) => {
        // First, sort by priority (higher priority first)
        const priorityDiff = (b.task_priority || 0) - (a.task_priority || 0);
        if (priorityDiff !== 0) return priorityDiff;
        
        // Then by created date (newer first)
        return new Date(b.created_at || 0) - new Date(a.created_at || 0);
    });
}

function getPriorityLevel(priority) {
    if (priority >= 0.15) return { class: 'high', text: 'High Priority' };
    if (priority >= 0.12) return { class: 'medium', text: 'Medium Priority' };
    return { class: 'low', text: 'Standard' };
}

function renderIncompleteTaskView(task) {
    // 1. Randomly pick one keyword from the task's list.
    const randomKeyword = task.keywords && task.keywords.length > 0
        ? task.keywords[Math.floor(Math.random() * task.keywords.length)]
        : '';

    // 2. Clean the URL to make it suitable for Google's "site:" search operator.
    const searchSite = task.url.replace(/(^\w+:|^)\/\//, '').replace(/^www\./, '');

    document.getElementById('content').innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary"><i class="ri-wallet-3-line"></i></div>
                <div class="stat-content">
                    <div class="stat-value">$${(currentData.user?.credit || 0).toFixed(2)}</div>
                    <div class="stat-label">Current Credit</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning"><i class="ri-loader-4-line"></i></div>
                <div class="stat-content">
                    <div class="stat-value">1</div>
                    <div class="stat-label">Task In Progress</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title" style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="ri-information-line"></i> How to Complete Your Task
                </h3>
            </div>
            <div class="card-body">
                <p style="color: var(--text-secondary); text-align: center; margin-bottom: 2rem;">
                    Follow these steps carefully to earn your reward.
                </p>

                <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: var(--radius-lg); text-align: left;">
                    <h4 style="margin-bottom: 1rem;">Your Instructions:</h4>
                    <ol style="padding-left: 1.5rem; line-height: 2;">
                        <li>On this <strong>same device</strong>, open a new browser tab and go to <strong>Google.com</strong>.</li>
                        <li>
                            Copy the text below and paste it into the Google search bar:
                            <div style="background: var(--bg); padding: 0.75rem 1rem; border-radius: var(--radius); margin: 0.75rem 0; font-family: monospace; font-size: 1rem; user-select: all; word-break: break-all;">
                                site:${searchSite} ${randomKeyword}
                            </div>
                        </li>
                        <li>From the search results, find and click the link for <strong>${task.url}</strong>.</li>
                        <li>Wait for the website to fully load. A special popup will appear with further instructions.</li>
                        <li>Click on all the "coins" that appear on the page as directed by the popup.</li>
                        <li>Once all coins are collected, you will be <strong>automatically redirected back here</strong> to see your updated balance. ✅</li>
                    </ol>
                </div>

                <div style="text-align: center; margin-top: 2.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">If you don't want to complete this task, you can cancel it.</p>
                    <button class="btn btn-danger" onclick="cancelInProgressTask('${task._id}')">
                        <i class="ri-close-circle-line"></i> Cancel & Forfeit Reward
                    </button>
                </div>
            </div>
        </div>
    `;
}

function renderAvailableTasksView() {
    clearCountdownIntervals();
    const content = document.getElementById('content');
    
    const totalTasks = paginationState.tasks.total || 0;
    
    content.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary"><i class="ri-wallet-3-line"></i></div>
                <div class="stat-content">
                    <div class="stat-value">$${(currentData.user?.credit || 0).toFixed(2)}</div>
                    <div class="stat-label">Current Credit</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon success"><i class="ri-check-double-line"></i></div>
                <div class="stat-content">
                    <div class="stat-value">${totalTasks}</div>
                    <div class="stat-label">Tasks Available</div>
                </div>
            </div>
        </div>
        <div class="task-grid">
            ${currentData.tasks.length > 0 ? currentData.tasks.map(renderTaskCard).join('') : `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state-icon"><i class="ri-task-line"></i></div>
                    <div class="empty-state-title">No Tasks Available Right Now</div>
                    <div class="empty-state-description">Please check back later for more opportunities to earn.</div>
                </div>
            `}
        </div>
        ${generatePagination('tasks', loadPartnerDashboard)}
    `;

    currentData.tasks.forEach(task => {
        if (!task.active) {
            startCountdown(task._id, task.remaining_time);
        }
    });
}

function renderTaskCard(task) {
    const credit = task.task_priority || 0;
    const isActive = task.active;
    const priority = getPriorityLevel(credit);
    
    return `
        <div class="available-task-card ${isActive ? 'active-task' : 'inactive-task'}" ${isActive ? `onclick="initiateTask('${task._id}')"` : ''}>
            <div class="task-card-header">
                <p class="task-url">${task.url}</p>
                <span class="task-priority-badge ${priority.class}">${priority.text}</span>
            </div>
            <div class="task-keywords">
                ${(task.keywords || []).slice(0, 5).map(kw => `<span class="keyword-badge">${kw}</span>`).join('')}
                ${(task.keywords || []).length > 5 ? `<span class="keyword-badge">+${(task.keywords || []).length - 5} more</span>` : ''}
            </div>
            <div class="task-footer">
                <div>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);">Reward</span>
                    <div class="task-credit">$${credit.toFixed(2)}</div>
                </div>
                ${isActive ? `
                    <button class="btn btn-primary btn-sm">Start Task <i class="ri-arrow-right-s-line"></i></button>
                ` : `
                    <div class="inactive-overlay">
                        <div id="countdown-${task._id}" style="font-weight: 600; font-size: 1rem; color: var(--text-secondary);">Available in ${task.remaining_time}m</div>
                        <small style="color: var(--text-tertiary); font-size: 0.7rem;">45 min cooldown</small>
                    </div>
                `}
            </div>
        </div>
    `;
}

async function initiateTask(userTaskId) {
    try {
        const uniqueId = getUniqueId();
        await api('/allocate-partner-task', {
            method: 'POST',
            body: JSON.stringify({ user_task_id: userTaskId, unique_id: uniqueId })
        });
        showToast('Task accepted! Please complete it.', 'success');
        loadPartnerDashboard();
    } catch (error) {
        showToast(error.message, 'error');
    }
}

async function cancelInProgressTask(partnerTaskId) {
    if (!confirm('Are you sure? Any progress will be lost.')) return;
    try {
        await api('/cancel-task', {
            method: 'POST',
            body: JSON.stringify({ task_id: partnerTaskId })
        });
        showToast('Task cancelled.', 'info');
        loadPartnerDashboard();
    } catch (error) {
        showToast('Failed to cancel task: ' + error.message, 'error');
    }
}

async function loadBalanceManagement(doneTasksPage = 1, withdrawalsPage = 1) {
    try {
        showSpinner();
        const response = await api(`/partner/balance-management?done_tasks_page=${doneTasksPage}&done_tasks_page_size=7&withdrawal_page=${withdrawalsPage}&withdrawal_page_size=10`);
        
        const { data, pagination } = response;
        currentData.balance = data;
        
        // Fix pagination state for balance page
        paginationState.done_tasks = {
            current: pagination.done_tasks?.current || doneTasksPage,
            page: pagination.done_tasks?.current || doneTasksPage,
            size: pagination.done_tasks?.size || 7,
            total: pagination.done_tasks?.total || 0,
            pages: pagination.done_tasks?.pages || 1,
            hasNext: pagination.done_tasks?.has_next || false
        };
        
        paginationState.withdrawals = {
            current: pagination.withdrawals?.current || withdrawalsPage,
            page: pagination.withdrawals?.current || withdrawalsPage,
            size: pagination.withdrawals?.size || 10,
            total: pagination.withdrawals?.total || 0,
            pages: pagination.withdrawals?.pages || 1,
            hasNext: pagination.withdrawals?.has_next || false
        };

        document.getElementById('content').innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Balance & Withdrawals</h2>
                <button class="btn btn-primary" onclick="showWithdrawalModal()">
                    <i class="ri-send-plane-line"></i> Withdraw Funds
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon primary"><i class="ri-wallet-3-line"></i></div>
                    <div class="stat-content">
                        <div class="stat-value">$${(data.balance || 0).toFixed(2)}</div>
                        <div class="stat-label">Available Balance</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon success"><i class="ri-line-chart-line"></i></div>
                    <div class="stat-content">
                        <div class="stat-value">$${(data.total_earn || 0).toFixed(2)}</div>
                        <div class="stat-label">Total Earned</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon warning"><i class="ri-task-line"></i></div>
                    <div class="stat-content">
                        <div class="stat-value">${data.number_of_done_tasks || 0}</div>
                        <div class="stat-label">Tasks Completed</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Earning History</h3>
                </div>
                <div class="card-body">
                    <!-- Desktop Table -->
                    <div class="table-container desktop-only">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>URL</th>
                                    <th>Country</th>
                                    <th>Reward</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(data.done_tasks_details || []).map(t => `
                                    <tr>
                                        <td>${new Date(t.time).toLocaleString()}</td>
                                        <td style="max-width: 300px; word-break: break-all;">${t.url}</td>
                                        <td>${t.country_code}</td>
                                        <td><span class="badge badge-success">$${(t.credit || 0).toFixed(2)}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile Cards -->
                    <div class="mobile-only">
                        ${(data.done_tasks_details || []).length > 0 ? data.done_tasks_details.map(t => {
                            const date = new Date(t.time).toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            return `
                            <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 0.85rem; color: var(--text); margin-bottom: 0.5rem; word-break: break-all; line-height: 1.3;">${t.url}</div>
                                        <div style="font-size: 0.75rem; color: var(--text-tertiary);">${date}</div>
                                    </div>
                                    <span class="badge badge-success" style="margin-left: 0.5rem;">$${(t.credit || 0).toFixed(2)}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">
                                    <i class="ri-map-pin-line"></i>
                                    <span>${t.country_code}</span>
                                </div>
                            </div>
                            `;
                        }).join('') : `
                            <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                <i class="ri-file-list-line" style="font-size: 2.5rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                                <p style="margin: 0; font-weight: 500;">No earning history yet</p>
                            </div>
                        `}
                    </div>
                </div>
                ${generatePagination('done_tasks', (page) => loadBalanceManagement(page, paginationState.withdrawals.current))}
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Withdrawal History</h3>
                </div>
                <div class="card-body">
                    <!-- Desktop Table -->
                    <div class="table-container desktop-only">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Address</th>
                                    <th>Status</th>
                                    <th>Transaction</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(data.withdrawals_details || []).map(w => {
                                    const status = w.status || 'Unknown';
                                    let badgeClass = 'warning';
                                    if (status.toLowerCase() === 'complete') badgeClass = 'success';
                                    if (['failed', 'rejected'].includes(status.toLowerCase())) badgeClass = 'danger';
                                    
                                    return `
                                    <tr>
                                        <td>${new Date(w.date).toLocaleString()}</td>
                                        <td style="font-weight: 600;">$${(w.amount || 0).toFixed(2)}</td>
                                        <td style="font-family: monospace; font-size: 0.8rem;">${w.address.substring(0, 10)}...${w.address.substring(w.address.length - 10)}</td>
                                        <td><span class="badge badge-${badgeClass}">${status}</span></td>
                                        <td style="font-family: monospace; font-size: 0.8rem;">
                                            ${w.txID ? `
                                                <a href="https://bscscan.com/tx/${w.txID}" target="_blank" style="color: var(--primary); text-decoration: none; display: flex; align-items: center; gap: 0.25rem;">
                                                    ${w.txID.substring(0,10)}...
                                                    <i class="ri-external-link-line"></i>
                                                </a>
                                            ` : 'Pending'}
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile Cards -->
                    <div class="mobile-only">
                        ${(data.withdrawals_details || []).length > 0 ? data.withdrawals_details.map(w => {
                            const status = w.status || 'Unknown';
                            let badgeClass = 'warning';
                            if (status.toLowerCase() === 'complete') badgeClass = 'success';
                            if (['failed', 'rejected'].includes(status.toLowerCase())) badgeClass = 'danger';
                            
                            const date = new Date(w.date).toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                year: new Date(w.date).getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
                            });
                            
                            return `
                            <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--text); margin-bottom: 0.25rem;">$${(w.amount || 0).toFixed(2)}</div>
                                        <div style="font-size: 0.75rem; color: var(--text-tertiary);">${date}</div>
                                    </div>
                                    <span class="badge badge-${badgeClass}" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">${status}</span>
                                </div>
                                
                                <div style="background: var(--bg-tertiary); padding: 0.75rem; border-radius: var(--radius-sm); margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Address:</div>
                                    <div style="font-family: monospace; font-size: 0.75rem; color: var(--text); word-break: break-all;">${w.address}</div>
                                </div>
                                
                                ${w.txID ? `
                                    <a href="https://bscscan.com/tx/${w.txID}" target="_blank" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem; background: var(--primary); color: white; border-radius: var(--radius); text-decoration: none; font-size: 0.85rem;">
                                        <i class="ri-external-link-line"></i>
                                        <span>View on BSCScan</span>
                                    </a>
                                ` : `
                                    <div style="text-align: center; padding: 0.5rem; background: var(--bg-tertiary); border-radius: var(--radius); font-size: 0.85rem; color: var(--text-secondary);">
                                        Transaction pending...
                                    </div>
                                `}
                            </div>
                            `;
                        }).join('') : `
                            <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                <i class="ri-exchange-line" style="font-size: 2.5rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                                <p style="margin: 0; font-weight: 500;">No withdrawal history</p>
                            </div>
                        `}
                    </div>
                </div>
                ${generatePagination('withdrawals', (page) => loadBalanceManagement(paginationState.done_tasks.current, page))}
            </div>
        `;
    } catch (error) {
        console.error('Balance error:', error);
        showErrorState('Failed to load balance information: ' + error.message);
    }
}

function showWithdrawalModal() {
    const balance = currentData.balance?.balance || 0;
    const minWithdrawal = 10;
    const fee = 1;

    showModal('Withdraw Funds', `
        <form id="withdrawForm">
            <div class="form-group">
                <label class="form-label">Available Balance</label>
                <input type="text" class="form-input" value="$${balance.toFixed(2)}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">Withdrawal Amount ($)</label>
                <input type="number" class="form-input" id="withdrawAmount" name="amount" required min="${minWithdrawal}" max="${balance}" step="0.01" placeholder="Enter amount">
                <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                    Minimum withdrawal: $${minWithdrawal.toFixed(2)}
                </small>
            </div>
            
            <div class="form-group">
                <label class="form-label">USDT (BEP20) Address</label>
                <input type="text" class="form-input" name="address" required placeholder="0x...">
                <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                    Make sure this is a valid BEP20 (BSC) address
                </small>
            </div>
            
            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); font-size: 0.875rem; margin-bottom: 1.5rem;">
                <div style="display:flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Amount:</span> 
                    <span id="summaryAmount" style="font-weight: 600;">$0.00</span>
                </div>
                <div style="display:flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Network Fee:</span> 
                    <span style="color: var(--error);">-$${fee.toFixed(2)}</span>
                </div>
                <hr style="border: none; border-top: 1px solid var(--border); margin: 0.75rem 0;">
                <div style="display:flex; justify-content: space-between; font-weight: 700; font-size: 1rem;">
                    <span>You Receive:</span> 
                    <span id="summaryNet" style="color: var(--success);">$0.00</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">Cancel</button>
                <button type="submit" class="btn btn-primary" style="flex: 2;">
                    <i class="ri-send-plane-line"></i> Request Withdrawal
                </button>
            </div>
        </form>
    `);
    
    document.getElementById('withdrawAmount').addEventListener('input', (e) => {
        const amount = parseFloat(e.target.value) || 0;
        document.getElementById('summaryAmount').textContent = `$${amount.toFixed(2)}`;
        document.getElementById('summaryNet').textContent = `$${Math.max(0, amount - fee).toFixed(2)}`;
    });

    document.getElementById('withdrawForm').addEventListener('submit', handleWithdrawal);
}

async function handleWithdrawal(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const amount = parseFloat(formData.get('amount'));
    const address = formData.get('address').trim();

    if (amount > (currentData.balance?.balance || 0)) {
        return showToast('Amount exceeds balance.', 'error');
    }
    if (amount < 10) {
        return showToast('Minimum withdrawal is $10.', 'error');
    }
    if (!/^0x[a-fA-F0-9]{40}$/.test(address)) {
        return showToast('Invalid BEP20 address format.', 'error');
    }

    try {
        await api('/partner/withdraw', { 
            method: 'POST', 
            body: JSON.stringify({ amount, address }) 
        });
        showToast('Withdrawal request submitted successfully!', 'success');
        closeModal();
        loadBalanceManagement();
    } catch (error) {
        showToast(`Withdrawal failed: ${error.message}`, 'error');
    }
}

function startCountdown(taskId, minutes) {
    const endTime = new Date().getTime() + minutes * 60 * 1000;
    const el = document.getElementById(`countdown-${taskId}`);
    if (!el) return;

    countdownIntervals[taskId] = setInterval(() => {
        const now = new Date().getTime();
        const distance = endTime - now;
        const minsLeft = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const secsLeft = Math.floor((distance % (1000 * 60)) / 1000);
        
        if (distance < 0) {
            clearInterval(countdownIntervals[taskId]);
            loadPartnerDashboard(paginationState.tasks.current);
        } else {
            el.textContent = `Available in ${minsLeft}m ${secsLeft}s`;
        }
    }, 1000);
}

function clearCountdownIntervals() {
    Object.values(countdownIntervals).forEach(clearInterval);
    countdownIntervals = {};
}

function generatePagination(type, loadFunction) {
    const pagination = paginationState[type];
    
    if (!pagination || pagination.total <= pagination.size) {
        return '';
    }

    const handlerId = `${type}_${Date.now()}`;
    paginationHandlers[handlerId] = loadFunction;

    const totalPages = Math.max(1, pagination.pages || 1);
    const currentPage = pagination.current || 1;
    const startItem = Math.max(1, ((currentPage - 1) * pagination.size) + 1);
    const endItem = Math.min(currentPage * pagination.size, pagination.total);

    let paginationHTML = '<div class="pagination">';

    // Previous button
    paginationHTML += `<button class="pagination-btn" ${currentPage <= 1 ? 'disabled' : ''} onclick="callPaginationHandler('${handlerId}', ${currentPage - 1})">
        <i class="ri-arrow-left-s-line"></i> Previous
    </button>`;

    // Page numbers
    if (totalPages <= 5) {
        for (let i = 1; i <= totalPages; i++) {
            paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="callPaginationHandler('${handlerId}', ${i})">${i}</button>`;
        }
    } else {
        if (currentPage > 2) {
            paginationHTML += `<button class="pagination-btn" onclick="callPaginationHandler('${handlerId}', 1)">1</button>`;
            if (currentPage > 3) {
                paginationHTML += '<span class="pagination-info">...</span>';
            }
        }

        const startPage = Math.max(1, currentPage - 1);
        const endPage = Math.min(totalPages, currentPage + 1);

        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="callPaginationHandler('${handlerId}', ${i})">${i}</button>`;
        }

        if (currentPage < totalPages - 1) {
            if (currentPage < totalPages - 2) {
                paginationHTML += '<span class="pagination-info">...</span>';
            }
            paginationHTML += `<button class="pagination-btn" onclick="callPaginationHandler('${handlerId}', ${totalPages})">${totalPages}</button>`;
        }
    }

    // Next button
    paginationHTML += `<button class="pagination-btn" ${!pagination.hasNext ? 'disabled' : ''} onclick="callPaginationHandler('${handlerId}', ${currentPage + 1})">
        Next <i class="ri-arrow-right-s-line"></i>
    </button>`;

    paginationHTML += `<div class="pagination-info">
        Page ${currentPage} of ${totalPages} | Showing ${startItem} to ${endItem} of ${pagination.total} results
    </div>`;

    paginationHTML += '</div>';
    return paginationHTML;
}

// Utility Functions
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
}

function showToast(message, type = 'info') {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <i class="ri-${type === 'success' ? 'check' : type === 'error' ? 'close' : type === 'warning' ? 'alert' : 'information'}-circle-line"></i>
        <span>${message}</span>
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
}

function showSpinner() {
    document.getElementById('content').innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; height: 300px;">
            <div class="spinner"></div>
        </div>
    `;
}

function showErrorState(message) {
    document.getElementById('content').innerHTML = `
        <div class="empty-state">
            <div class="empty-state-icon"><i class="ri-error-warning-line"></i></div>
            <div class="empty-state-title">Error</div>
            <div class="empty-state-description">${message}</div>
            <button class="btn btn-primary" onclick="location.reload()">
                <i class="ri-refresh-line"></i> Retry
            </button>
        </div>
    `;
}

function closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
}

function showModal(title, content, width = '600px') {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = content;
    const modal = document.querySelector('.modal');
    modal.style.width = width;
    modal.style.maxWidth = '95vw';
    document.getElementById('modalOverlay').classList.add('active');
}

async function logout() {
    document.cookie = 'session_token_partner=;path=/;domain=.seotize.net;expires=Thu, 01 Jan 1970 00:00:00 GMT';
    localStorage.removeItem('partnerAuthToken');
    window.location.href = '/partner/login';
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('mobileProfileDropdown');
    const button = document.querySelector('.mobile-profile-menu');
    if (dropdown && button && !dropdown.contains(event.target) && !button.contains(event.target)) {
        closeMobileProfileDropdown();
    }
});
</script>
</body>
</html>
